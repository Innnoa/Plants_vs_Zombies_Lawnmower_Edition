# 割草游戏（Lawn Mower）完整架构方案

## 📋 项目概述

 **项目名称**：你好刚玩一个月
 **类型**：多人在线割草类游戏
 **平台**：PC（Windows/Linux/macOS）
 **联机方式**：本地局域网联机（主机-客户端模式）
 **开发语言**：C++（服务端）+ Java（客户端）

------

## 🏗️ 总体架构设计

### 架构图

```
┌─────────────────────────────────────────────────────────────┐
│                      游戏客户端 (Java)                        │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ 渲染引擎  │  │ UI系统    │  │ 输入系统  │  │ 音效系统  │     │
│  └─────┬────┘  └─────┬────┘  └─────┬────┘  └──────────┘     │
│        │             │             │                        │
│        └─────────────┴─────────────┘                        │
│                      │                                      │
│              ┌───────▼────────┐                             │
│              │  网络通信层     │                              │
│              │ (Netty/NIO)    │                             │
│              └───────┬────────┘                             │
└──────────────────────┼──────────────────────────────────────┘
                       │
                       │ TCP (命令) + UDP (状态同步)
                       │
┌──────────────────────▼──────────────────────────────────────┐
│                    游戏服务器 (C++)                           │
│  ┌──────────┐  ┌──────────┐  ┌──────────┐  ┌──────────┐     │
│  │ 房间管理  │  │ 玩家管理  │  │ 游戏逻辑  │  │ 网络层    │     │
│  └─────┬────┘  └─────┬────┘  └─────┬────┘  └─────┬────┘     │
│        │             │             │             │          │
│        └─────────────┴─────────────┴─────────────┘          │
│                      │                                      │
│              ┌───────▼────────┐                             │
│              │  核心游戏引擎   │                              │
│              │ - 碰撞检测      │                             │
│              │ - 敌人AI       │                              │
│              │ - 物理模拟     │                              │
│              │ - 掉落系统     │                              │
│              └────────────────┘                             │
└─────────────────────────────────────────────────────────────┘
```

### 架构模式

| 层级       | 技术                 | 职责                         |
| ---------- | -------------------- | ---------------------------- |
| **表现层** | Java + LibGDX        | 游戏渲染、UI显示、用户交互   |
| **通信层** | TCP/UDP + Protobuf   | 客户端-服务器数据传输        |
| **逻辑层** | C++                  | 游戏规则、状态管理、权威计算 |
| **数据层** | 内存（可扩展数据库） | 玩家数据、房间状态           |

------

## 👥 团队职责划分

### C++ 开发者职责（服务端）

| 模块         | 功能描述                          |      | 优先级 |
| ------------ | --------------------------------- | ---- | ------ |
| **网络框架** | TCP/UDP服务器搭建，连接管理       |      | P0     |
| **房间系统** | 创建/加入/离开房间，房间列表      |      | P0     |
| **玩家管理** | 玩家连接、断线重连、状态同步      |      | P0     |
| **游戏循环** | 60Hz tick，状态更新广播           |      | P0     |
| **碰撞检测** | 空间分区（四叉树/网格），AABB碰撞 |      | P1     |
| **敌人系统** | 生成算法、AI寻路、类型管理        |      | P1     |
| **战斗系统** | 伤害计算、技能CD、buff/debuff     |      | P1     |
| **成长系统** | 经验、升级、属性计算              |      | P2     |
| **掉落系统** | 物品生成、拾取判定                |      | P2     |
| **性能优化** | 内存池、对象池、多线程优化        |      | P2     |
| **日志监控** | 服务器日志、性能指标收集          |      | P2     |

### Java 开发者职责（客户端）

| 模块           | 功能描述                     | 预估工时 | 优先级 |
| -------------- | ---------------------------- | -------- | ------ |
| **框架搭建**   | LibGDX项目初始化，场景管理   |          | P0     |
| **网络通信**   | Socket连接、消息收发、心跳   |          | P0     |
| **主菜单UI**   | 登录界面、房间列表、设置     |          | P0     |
| **游戏渲染**   | 玩家/敌人/地图渲染，相机系统 |          | P1     |
| **输入系统**   | 键盘/鼠标/手柄输入映射       |          | P1     |
| **客户端预测** | 本地玩家平滑移动，延迟补偿   |          | P1     |
| **状态插值**   | 其他玩家/敌人位置平滑        |          | P1     |
| **游戏HUD**    | 生命条、经验条、技能图标     |          | P2     |
| **特效系统**   | 粒子效果、攻击特效、死亡动画 |          | P2     |
| **音效系统**   | 背景音乐、音效播放、音量控制 |          | P2     |
| **优化调试**   | FPS优化、内存管理、断线重连  |          | P2     |

------

## 🔧 技术栈详细选型

### C++ 服务端技术栈

| 组件         | 选型             | 版本要求  | 选择理由                      |
| ------------ | ---------------- | --------- | ----------------------------- |
| **编译器**   | GCC/Clang/MSVC   | C++20支持 | 使用协程、concept等现代特性   |
| **网络库**   | Asio             | 1.24+     | 异步IO，跨平台，C++20协程支持 |
| **序列化**   | Protocol Buffers | 3.21+     | 高性能、跨语言、版本兼容      |
| **日志库**   | spdlog           | 1.11+     | 高性能异步日志                |
| **JSON库**   | nlohmann/json    | 3.11+     | 调试阶段使用                  |
| **构建系统** | CMake            | 3.20+     | 跨平台构建                    |
| **测试框架** | Google Test      | 1.12+     | 单元测试                      |
| **数学库**   | GLM              | 0.9.9+    | 向量、矩阵运算                |

### Java 客户端技术栈

| 组件         | 选型                 | 版本要求 | 选择理由                 |
| ------------ | -------------------- | -------- | ------------------------ |
| **JDK**      | OpenJDK              | 17 LTS   | 长期支持版本             |
| **游戏引擎** | LibGDX               | 1.12+    | 成熟的2D游戏框架，跨平台 |
| **网络库**   | Netty                | 4.1+     | 高性能NIO框架，事件驱动  |
| **序列化**   | Protobuf Java        | 3.21+    | 与服务端保持一致         |
| **构建工具** | Gradle               | 8.0+     | LibGDX官方推荐           |
| **UI框架**   | Scene2D (LibGDX内置) | -        | 与LibGDX无缝集成         |
| **音效**     | LibGDX Audio         | -        | 内置音频系统             |

------

## 📡 通信协议设计

### 协议层次

```
应用层：游戏消息（Protobuf序列化）
传输层：TCP（可靠命令）+ UDP（快速状态）
网络层：IPv4
```

### 消息分类

| 消息类型     | 传输协议 | 频率     | 示例                         |
| ------------ | -------- | -------- | ---------------------------- |
| **连接管理** | TCP      | 按需     | 登录、断线、心跳             |
| **房间操作** | TCP      | 按需     | 创建房间、加入房间、离开房间 |
| **游戏命令** | TCP      | 低频     | 升级选择、技能释放           |
| **玩家输入** | UDP      | 60Hz     | 移动方向、攻击状态           |
| **状态同步** | UDP      | 20-30Hz  | 玩家位置、敌人状态           |
| **事件通知** | TCP      | 事件驱动 | 玩家死亡、BOSS出现           |

------

## 📁 项目目录结构(文件命名不要带空格,填充符号使用下划线"_")

### C++ 服务器目录

```
LawnMowerServer/
├── CMakeLists.txt
├── README.md
├── .gitignore
├── include/
│   ├── network/
│   │   ├── tcp_server.hpp
│   │   ├── udp_server.hpp
│   │   └── session.hpp
│   ├── game/
│   │   ├── game_room.hpp
│   │   ├── player.hpp
│   │   ├── enemy.hpp
│   │   ├── item.hpp
│   │   └── collision.hpp
│   ├── proto/
│   │   └── messages.pb.h (生成)
│   └── utils/
│       ├── logger.hpp
│       └── timer.hpp
├── src/
│   ├── main.cpp
│   ├── network/
│   ├── game/
│   └── utils/
├── proto/
│   └── messages.proto
├── tests/
│   ├── test_collision.cpp
│   └── test_game_logic.cpp
└── third_party/
    ├── asio/
    ├── protobuf/
    └── spdlog/
```

### Java 客户端目录

```
LawnMowerClient/
├── build.gradle
├── settings.gradle
├── README.md
├── .gitignore
├── core/
│   └── src/
│       └── com/
│           └── lawnmower/
│               ├── LawnMowerGame.java
│               ├── network/
│               │   ├── NetworkManager.java
│               │   ├── MessageHandler.java
│               │   └── ProtobufCodec.java
│               ├── screens/
│               │   ├── MenuScreen.java
│               │   ├── RoomScreen.java
│               │   └── GameScreen.java
│               ├── entities/
│               │   ├── Player.java
│               │   ├── Enemy.java
│               │   └── Item.java
│               ├── rendering/
│               │   ├── GameRenderer.java
│               │   └── EffectRenderer.java
│               ├── input/
│               │   └── GameInputProcessor.java
│               └── utils/
│                   └── Interpolator.java
├── desktop/
│   └── src/
│       └── DesktopLauncher.java
├── assets/
│   ├── sprites/
│   ├── sounds/
│   ├── music/
│   └── ui/
└── proto/
    └── messages.proto (从服务器同步)
```

------

## 🛠️ 必备开发工具(我到时候研究一下其中几个)

### 通用工具

| 工具          | 用途     | 必要性 | 推荐配置                         |
| ------------- | -------- | ------ | -------------------------------- |
| **Git**       | 版本控制 | ⭐⭐⭐⭐⭐  | 分支策略：main/develop/feature/* |
| **GitHub**    | 代码托管 | ⭐⭐⭐⭐⭐  | 私有仓库，开启CI/CD              |
| **MarkDown**  | 文档管理 | ⭐⭐⭐⭐   | 记录设计文档、会议纪要           |
| **Jira**      | 任务管理 | ⭐⭐⭐⭐   | 敏捷看板，Sprint规划             |
| **Wireshark** | 网络调试 | ⭐⭐⭐    | 抓包分析网络问题                 |
| **Postman**   | API测试  | ⭐⭐⭐    | 测试网络协议                     |
|               |          |        |                                  |

### C++ 开发工具

| 工具            | 用途     | 推荐                                     |
| --------------- | -------- | ---------------------------------------- |
| **IDE**         | 代码编写 | CLion                                    |
| **调试器**      | Bug定位  | GDB / LLDB / VS Debugger                 |
| **性能分析**    | 优化     | Valgrind / perf / Visual Studio Profiler |
| **内存检查**    | 内存泄漏 | Valgrind / AddressSanitizer              |
| **vcpkg/Conan** | 包管理   | 管理第三方库                             |

### Java 开发工具(不懂,你自己看着来)

| 工具         | 用途     | 推荐                 |
| ------------ | -------- | -------------------- |
| **IDE**      | 代码编写 | IntelliJ IDEA        |
| **调试器**   | Bug定位  | IntelliJ Debugger    |
| **性能分析** | 优化     | JProfiler / VisualVM |
| **Gradle**   | 构建工具 | LibGDX项目标配       |

------

## 📝 开发规范与协作流程

### Git 工作流（Git Flow）(一会发库链接)

```
main (稳定版本)
  ↑
develop (开发主线)
  ↑
feature/player-movement (功能分支)
feature/enemy-ai
hotfix/network-crash (紧急修复)
```

### Code Review 流程(这个到时候再说)

1. **提交 Pull Request**：功能完成后创建PR
2. **自我检查**：确保代码符合规范，测试通过
3. **指定审查者**：@对方进行代码审查
4. 审查清单：
   - ✅ 代码逻辑正确
   - ✅ 符合编码规范
   - ✅ 无明显性能问题
   - ✅ 有必要的注释
   - ✅ 测试覆盖关键路径
5. **修改反馈**：根据评论修改
6. **合并代码**：审查通过后合并到develop

# 代码规范

#### C++ 代码规范

Google c++

#### Java 代码规范

不懂,你看着来

------

## 🧪 测试策略

### 测试清单

| 测试类型     | C++ 服务器                               | Java 客户端                              |
| ------------ | ---------------------------------------- | ---------------------------------------- |
| **单元测试** | ✅ 碰撞检测<br>✅ 伤害计算<br>✅ 升级逻辑   | ✅ 消息解析<br>✅ 状态插值<br>✅ 输入处理   |
| **集成测试** | ✅ 网络收发<br>✅ 房间管理<br>✅ 多玩家交互 | ✅ 服务器连接<br>✅ 断线重连<br>✅ 渲染流程 |
| **性能测试** | ✅ 1000敌人压测<br>✅ 内存泄漏检测         | ✅ FPS稳定性<br>✅ 内存占用                |
| **压力测试** | ✅ 多房间并发<br>✅ 极端网络延迟           | ✅ 长时间运行<br>✅ 快速切换场景           |

------

## 📅 开发里程碑

### 迭代计划（敏捷开发，2周一个Sprint）

| Sprint                 | 目标               | 交付物                                                    |      |
| ---------------------- | ------------------ | --------------------------------------------------------- | ---- |
| **Sprint 0**(准备阶段) | 环境搭建、协议定义 | - 开发环境配置完成<br>- Protobuf消息定义<br>- Git仓库建立 |      |
| **Sprint 1**(基础联机) | 实现基本连接与移动 | - 服务器接受连接<br>- 客户端连接成功<br>- 单人移动同步    |      |
| **Sprint 2**(多人同步) | 多玩家状态同步     | - 房间管理功能<br>- 多人实时移动<br>- 基础UI界面          |      |
| **Sprint 3**(核心玩法) | 敌人与战斗         | - 敌人生成与渲染<br>- 碰撞检测<br>- 攻击与伤害            |      |
| **Sprint 4**(成长系统) | 升级与掉落         | - 经验值与升级<br>- 物品掉落<br>- 技能系统雏形            |      |
| **Sprint 5**(优化打磨) | 性能与体验         | - 性能优化<br>- 特效增强<br>- Bug修复                     |      |
| **Sprint 6**(测试发布) | 完整测试与发布     | - 完整游戏流程<br>- 压力测试通过<br>- 可发布版本          |      |

------

## 🎓 多人协作必备素质

### 技术素质

| 能力           | 重要性 | 说明                                    |
| -------------- | ------ | --------------------------------------- |
| **Git 熟练度** | ⭐⭐⭐⭐⭐  | 掌握分支、合并、冲突解决、rebase        |
| **调试能力**   | ⭐⭐⭐⭐⭐  | 会用调试器、日志定位问题                |
| **文档编写**   | ⭐⭐⭐⭐   | 清晰的代码注释、设计文档,MarkDown就可以 |
| **网络知识**   | ⭐⭐⭐⭐   | 理解TCP/UDP、延迟、丢包                 |
| **性能意识**   | ⭐⭐⭐⭐   | 避免过早优化，但要识别瓶颈              |

### 协作最佳实践

1. **每日同步**：
   - 昨天做了什么
   - 今天计划做什么
   - 遇到什么阻碍
2. **定期Review**：
   - 互相审查对方代码
   - 讨论架构问题
   - 规划下周任务
3. **文档先行**：
   - 修改协议前先更新文档
   - 重要决策写到github
   - API变更提前通知
4. **测试驱动**：
   - 核心功能写单元测试
   - 集成前自测功能
   - 发现Bug先写复现测试
5. **问题升级机制**：
   - 卡住30分钟→自己研究
   - 卡住2小时→询问对方
   - 卡住1天→重新评估方案

------

## ✅ 启动前检查清单

### 开发环境

[ ] C++编译器支持C++20

[ ] Java 17 LTS已安装

[ ] Git已配置（用户名、邮箱）

[ ] IDE/编辑器已安装并配置

### 项目设置

[ ] GitHub仓库已创建（2个：server + client）(一会我发链接)

[ ] Protobuf 编译工具已安装

[ ] CMake项目能成功构建

[ ] Gradle项目能成功构建

### 协作工具(这个我到时候研究研究)

[ ] Trello看板已创建并分配任务

[ ] Notion文档空间已设置

### 知识储备

[ ] 已阅读本架构文档

[ ] 已阅读 Gaffer On Games 网络同步文章

[ ] 已了解Protobuf基本使用

[ ] 已了解Git基本工作流

# 流程图

#### 等我看一下具体流程